---
title: 'å†è°ˆ MCP - Model Context Protocolï¼ˆMCPï¼‰è¯¦è§£å’Œå¼€å‘æ•™ç¨‹'
date: '2025-07-21'
tags: ['AI', 'MCP', 'LLM']
draft: false
summary: 'åœ¨å‰æ–‡åŸºç¡€ä¸Šï¼Œæœ¬æ–‡è¿›ä¸€æ­¥æ·±å…¥è§£æ MCP çš„é€šä¿¡æœºåˆ¶ä¸åŸè¯­è§„èŒƒï¼Œç³»ç»Ÿæ¢³ç†å…¶æ¶ˆæ¯ç»“æ„ã€ç”Ÿå‘½å‘¨æœŸä¸èƒ½åŠ›åå•†æµç¨‹ï¼Œå¹¶é€šè¿‡å¤©æ°”æŸ¥è¯¢ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…æŒæ¡ MCP Server çš„æ„å»ºè¦é¢† ...'
images: ['/static/images/blog/202507/MCP_Revisited/MCP_Revisited.webp']
authors: ['default']
---

## 1. ä»€ä¹ˆæ˜¯ MCP

MCPï¼ˆModel Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æœ€æ—©ç”± Anthropic äº 2024 å¹´ 11 æœˆ 25 æ—¥åœ¨æ–‡ç« ã€ŠIntroducing the Model Context Protocolã€‹ä¸­æå‡ºã€‚

å®ƒæ—¨åœ¨å®šä¹‰ä¸€ç§æ ‡å‡†ï¼Œç”¨äºåœ¨åº”ç”¨ç¨‹åºä¸å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¹‹é—´äº¤æ¢ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å€ŸåŠ© MCPï¼Œå¼€å‘è€…å¯ä»¥ä»¥ç»Ÿä¸€çš„æ–¹å¼å°†æ•°æ®ã€å·¥å…·å’Œç¯å¢ƒæä¾›ç»™ AIï¼Œè®© AI ä¸å†å±€é™äºâ€œå›ç­”é—®é¢˜â€ï¼Œè€Œæ˜¯å…·å¤‡â€œæ‰§è¡Œä»»åŠ¡â€çš„èƒ½åŠ›ã€‚

ä½ å¯ä»¥æŠŠ MCP ç†è§£ä¸º AI çš„ **Type-C æ¥å£**ï¼šå°±åƒ Type-C è®©ç”µè„‘èƒ½è¿æ¥æ˜¾ç¤ºå™¨ã€é”®ç›˜ã€è€³æœºä¸€æ ·ï¼ŒMCP ä¹Ÿè®©è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ Claudeã€GPTï¼‰èƒ½å¤Ÿæ ‡å‡†åŒ–ã€å®‰å…¨åœ°è®¿é—®å¤–éƒ¨å·¥å…·ã€æ–‡ä»¶ã€æ•°æ®åº“å’Œä¸Šä¸‹æ–‡èµ„æºã€‚

![MCP_typec](/static/images/blog/202507/MCP_Revisited/MCP_typec.webp)

MCP çš„è¯ç”Ÿæºäºè§£å†³ LLM åº”ç”¨çš„ä¸€ä¸ªå…³é”®é™åˆ¶ï¼Œå³å®ƒä»¬ä¸å¤–éƒ¨å’Œæ•°æ®æºå·¥å…·çš„éš”ç¦»é—®é¢˜ã€‚
LLM åº”ç”¨çš„ä¸€ä¸ªæ ¸å¿ƒå…³æ³¨ç‚¹æ˜¯æ•°æ®ä¼ è¾“ï¼Œå³å¦‚ä½•å°†æ•°æ®æä¾›ç»™ LLM è¿›è¡Œæ¨ç†ã€‚è¿™ä¸€ç›´æ˜¯ RAG å’Œå¾®è°ƒçš„ç›®æ ‡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ MCP çš„ç›®æ ‡ã€‚

## 2. ä¸ºä»€ä¹ˆéœ€è¦ MCPï¼Ÿ

åœ¨æ²¡æœ‰ MCP ä¹‹å‰ï¼Œä½¿ç”¨ AI å¾€å¾€æ„å‘³ç€ç”¨æˆ·éœ€è¦æ‰‹åŠ¨æœé›†å¹¶æ‰“åŒ…æ‰€æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸€æ¬¡æ€§åœ°é€šè¿‡ prompt æä¾›ç»™æ¨¡å‹ï¼Œç„¶åé™å¾…å…¶ç”Ÿæˆå›ç­”ã€‚

è¿™é€šå¸¸è¦æ±‚ç”¨æˆ·äº²è‡ªæŸ¥è¯¢æ•°æ®åº“ã€æœç´¢ç½‘é¡µã€å¤åˆ¶ç²˜è´´å†…å®¹ï¼Œå¹¶å°†å…¶ç»„ç»‡æˆ prompt æ ¼å¼ã€‚éšç€ä»»åŠ¡å¤æ‚åº¦ä¸æ–­æé«˜ï¼Œç”¨æˆ·å¯¹æ¨¡å‹çš„æœŸæœ›ä¹Ÿåœ¨ä¸Šå‡â€”â€”ä»–ä»¬å¸Œæœ›æ¨¡å‹èƒ½ç›´æ¥è®¿é—®æ–‡ä»¶ã€æ•°æ®åº“ã€å®æ—¶ä¿¡æ¯ç­‰å¤–éƒ¨èµ„æºï¼Œä»¥æä¾›æ›´åŠ å‡†ç¡®ã€ä¸Šä¸‹æ–‡ç›¸å…³çš„å“åº”ã€‚

ä¸ºæ»¡è¶³è¿™ä¸€éœ€æ±‚ï¼Œè®¸å¤š LLM å¹³å°é™†ç»­å¼•å…¥äº† Function Callingï¼šæ¨¡å‹å¯ä»¥åœ¨è¿è¡Œæ—¶è°ƒç”¨å¼€å‘è€…æ³¨å†Œçš„å‡½æ•°ï¼Œå®ç°è‡ªåŠ¨è·å–æ•°æ®æˆ–è§¦å‘æ“ä½œï¼Œä»è€Œæ˜¾è‘—æå‡äº¤äº’æ€§å’Œè‡ªåŠ¨åŒ–èƒ½åŠ›ã€‚

ç„¶è€Œï¼ŒFunction Calling æœ¬èº«ä¹Ÿå­˜åœ¨å±€é™ã€‚å„å®¶å¹³å°ï¼ˆå¦‚ OpenAIã€Googleã€Anthropicï¼‰è™½éƒ½æä¾›æ­¤èƒ½åŠ›ï¼Œä½†ç¼ºä¹ç»Ÿä¸€æ ‡å‡†ï¼Œå‡½æ•°ç»“æ„ã€è°ƒç”¨åè®®å„å¼‚ï¼Œå¯¼è‡´å¼€å‘è€…å¿…é¡»ä¸ºæ¯ä¸ªå¹³å°åˆ†åˆ«ç¼–å†™å’Œé€‚é…å·¥å…·é€»è¾‘ï¼Œå¢åŠ äº†ç»´æŠ¤è´Ÿæ‹…å’Œé‡å¤å¼€å‘æˆæœ¬ã€‚

MCPï¼ˆModel Context Protocolï¼‰æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€ç¢ç‰‡åŒ–é—®é¢˜è€Œè¯ç”Ÿã€‚å®ƒå®šä¹‰äº†æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·ä¹‹é—´çš„ç»Ÿä¸€é€šä¿¡åè®®ï¼Œç›¸å½“äº AI ä¸–ç•Œä¸­çš„â€œä¸‡èƒ½æ’å¤´â€ï¼Œä¸ºæ¨¡å‹ä¸ç°å®ä¸–ç•Œä¹‹é—´æ¶èµ·ä¸€åº§æ ‡å‡†åŒ–çš„æ¡¥æ¢ã€‚

ç›¸è¾ƒäºä¼ ç»Ÿçš„ Function Callingï¼ŒMCP å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- **âœ… æ ‡å‡†åŒ–æ¥å£**ï¼šå¼€å‘è€…å¯ä»¥ä½¿ç”¨ç»Ÿä¸€æ ¼å¼ä¸ºä¸åŒæ¨¡å‹æ¥å…¥å·¥å…·ï¼Œæ— éœ€é‡å¤é€‚é…ã€‚
- **ğŸŒ± ç”Ÿæ€ä¸°å¯Œ**ï¼šå·²æœ‰ä¼—å¤šç¬¬ä¸‰æ–¹å·¥å…·ã€ç»„ä»¶å’Œæ¡†æ¶æ”¯æŒ MCPï¼Œç”Ÿæ€é€æ¸æˆç†Ÿã€‚
- **ğŸ” å®‰å…¨å¯é **ï¼šæ”¯æŒåœ¨æœ¬åœ°æˆ–å—æ§ç¯å¢ƒä¸­æ‰§è¡Œå·¥å…·è°ƒç”¨ï¼Œé¿å…ä¸Šä¼ æ•æ„Ÿæ•°æ®ã€‚

## **3. åŸºæœ¬æ¦‚å¿µ**

| åç§°               | ç±»å‹                    | è¯´æ˜                                                                                       |
| ------------------ | ----------------------- | ------------------------------------------------------------------------------------------ |
| **Tools å·¥å…·**     | Server æä¾›çš„å¯è°ƒç”¨å·¥å…· | MCP Server æä¾›çš„åŠŸèƒ½æ–¹æ³•ï¼Œå¦‚æœç´¢ä»“åº“ã€è·å–å¤©æ°”ï¼ŒClient é€šè¿‡`tools/list`å’Œ`tools/call`ä½¿ç”¨ |
| **Resources èµ„æº** | Server æä¾›çš„å¯è¯»æ•°æ®   | æ–‡æ¡£ã€API æ•°æ®ã€æ–‡ä»¶ç­‰ã€‚é€šè¿‡`resources/list`å’Œ`resources/read`è·å–å†…å®¹                     |
| **Prompts æç¤º**   | æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ          | MCP Server æä¾›çš„æç¤ºæ¨¡æ¿ï¼Œç”¨äºä¸°å¯Œæ¨¡å‹æç¤ºæ„é€ ï¼ŒClient é€šè¿‡`prompts/list`ä½¿ç”¨             |
| **Sampling é‡‡æ ·**  | æ¨ç†ç”Ÿæˆç›¸å…³èƒ½åŠ›        | MCP Server å¯é€šè¿‡`sampling/createMessage`è¯·æ±‚è¯­è¨€æ¨¡å‹ç”Ÿæˆå“åº”                              |
| **Roots**          | æ–‡ä»¶ç³»ç»ŸæŒ‚è½½æ ¹          | ç”¨äºæš´éœ²æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç›®å½•ç»™ MCP Server                                                      |
| **Capabilities**   | åˆå§‹åŒ–åå•†çš„åŠŸèƒ½æ¸…å•    | Client å’Œ Server åå•†åŠŸèƒ½èƒ½åŠ›ï¼ˆå¦‚æ˜¯å¦æ”¯æŒå·¥å…·åˆ—è¡¨å˜æ›´ã€èµ„æºè®¢é˜…ç­‰ï¼‰                        |

## 4. MCP æ¶æ„å’Œé€šè®¯æœºåˆ¶

### 4.1 æ€»ä½“æ¶æ„

MCP éµå¾ªå®¢ **å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„**ï¼Œä¸»æœºç¨‹åºï¼ˆå¦‚ Claude Desktopï¼‰å¯ä»¥è¿æ¥å¤šä¸ªåç«¯æœåŠ¡ï¼ˆå³ MCP æœåŠ¡å™¨ï¼‰ï¼Œå°±åƒæµè§ˆå™¨å¯ä»¥è¿æ¥å¤šä¸ªç½‘ç«™ä¸€æ ·ã€‚

![MCP_Architecture](/static/images/blog/202507/MCP_Revisited/MCP_Architecture.webp)

- **MCP Hosts**ï¼šåƒ Claude Desktopã€IDE æˆ– AI å·¥å…·ç­‰ç¨‹åºï¼Œå®ƒä»¬å¸Œæœ›é€šè¿‡ MCP è®¿é—®æ•°æ®ã€‚
  å®¿ä¸»è¿›ç¨‹å……å½“å®¹å™¨å’Œåè°ƒå™¨ï¼š
  - åˆ›å»ºå’Œç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯å®ä¾‹
  - æ§åˆ¶å®¢æˆ·ç«¯è¿æ¥æƒé™å’Œç”Ÿå‘½å‘¨æœŸ
  - æ‰§è¡Œå®‰å…¨æ”¿ç­–å’ŒåŒæ„è¦æ±‚
  - å¤„ç†ç”¨æˆ·æˆæƒå†³ç­–
  - åè°ƒ AI/LLM é›†æˆå’Œé‡‡æ ·
  - ç®¡ç†è·¨å®¢æˆ·ç«¯çš„ä¸Šä¸‹æ–‡èšåˆ
- **MCP Clients**ï¼šä¸æœåŠ¡å™¨ä¿æŒ 1:1 è¿æ¥çš„åè®®å®¢æˆ·ç«¯ã€‚
  æ¯ä¸ªå®¢æˆ·ç«¯ç”±ä¸»æœºåˆ›å»ºå¹¶ç»´æŠ¤ä¸€ä¸ªéš”ç¦»çš„æœåŠ¡å™¨è¿æ¥ï¼š
  - æ¯ä¸ªæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªæœ‰çŠ¶æ€ä¼šè¯
  - å¤„ç†åè®®åå•†å’Œèƒ½åŠ›äº¤æ¢
  - åŒå‘è·¯ç”±åè®®æ¶ˆæ¯
  - ç®¡ç†è®¢é˜…å’Œé€šçŸ¥
  - ç»´æŠ¤æœåŠ¡å™¨ä¹‹é—´çš„å®‰å…¨è¾¹ç•Œ
    ä¸»æœºåº”ç”¨ç¨‹åºåˆ›å»ºå¹¶ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯ä¸ç‰¹å®šæœåŠ¡å™¨å…·æœ‰ 1:1 çš„å…³ç³»ã€‚
    ![MCP_client_server](/static/images/blog/202507/MCP_Revisited/MCP_client_server.webp)
- **MCP Servers**ï¼šé€šè¿‡æ ‡å‡†åŒ–çš„æ¨¡å‹ä¸Šä¸‹æ–‡åè®®æš´éœ²ç‰¹å®šåŠŸèƒ½çš„è½»é‡çº§ç¨‹åºã€‚
  æœåŠ¡å™¨æä¾›ä¸“é—¨çš„ä¸Šä¸‹æ–‡å’ŒåŠŸèƒ½ï¼š
  - é€šè¿‡ MCP åŸè¯­å…¬å¼€èµ„æºã€å·¥å…·å’Œæç¤º
  - ç‹¬ç«‹è¿ä½œï¼Œä¸“æ³¨è´Ÿè´£
  - é€šè¿‡å®¢æˆ·ç«¯ç•Œé¢è¯·æ±‚é‡‡æ ·
  - å¿…é¡»å°Šé‡å®‰å…¨çº¦æŸ
  - å¯ä»¥æ˜¯æœ¬åœ°è¿›ç¨‹æˆ–è¿œç¨‹æœåŠ¡
- **Local Data Source**ï¼šè®¡ç®—æœºæ–‡ä»¶ã€æ•°æ®åº“ä»¥åŠ MCP æœåŠ¡å™¨å¯ä»¥å®‰å…¨è®¿é—®çš„æœåŠ¡ã€‚
- **Remote Services**ï¼šMCP æœåŠ¡å™¨å¯ä»¥é€šè¿‡ API ç­‰æ–¹å¼è¿æ¥åˆ°çš„äº’è”ç½‘å¤–éƒ¨ç³»ç»Ÿã€‚

**æ•´ä½“è¿è¡Œæµç¨‹æ€»ç»“**ï¼š

å½“ä½ å‘ AI æå‡ºé—®é¢˜æ—¶ï¼Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š

- æé—® âœ Host âœ LLM âœ MCP Client âœ MCP Server âœ æ‰§è¡Œæ“ä½œ âœ è¿”å›ç»“æœ âœ LLM ç”Ÿæˆå›ç­” âœ å±•ç¤ºç­”æ¡ˆ

è¿™æ ·çš„æ¶æ„è®¾è®¡å¯ä»¥è®© LLM æ›´çµæ´»åœ°è°ƒç”¨å„ç§æ•°æ®å’Œå·¥å…·ã€‚å¼€å‘è€…åªéœ€ä¸“æ³¨äºå¼€å‘ MCP Serverï¼Œç”¨æˆ·ä¹Ÿæ— éœ€é¢å¤–å­¦ä¹ æˆæœ¬ï¼Œå°±èƒ½è·å¾—æ™ºèƒ½åŒ–ä½“éªŒã€‚

### 4.2 ä¼ è¾“åè®®

> [!NOTE] > [ğŸ“– Source](https://modelcontextprotocol.io/specification/2025-03-26/basic/transports#stdiohttps://github.com/modelcontextprotocol/modelcontextprotocol/blob/e0a7d3b7cc286496b5a4585be85e6bd4ff186e36/docs/specification/2025-03-26/basic/transports.mdx?plain=1)

åè®®ç›®å‰å®šä¹‰äº†ä¸¤ç§æ ‡å‡†ä¼ è¾“æœºåˆ¶ç”¨äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šä¿¡ï¼š

1. **stdio**ï¼Œæ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡ºçš„é€šä¿¡
2. **Streamable HTTP** å¯æµå¼ä¼ è¾“çš„ HTTP

å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥ä»¥æ’ä»¶çš„å½¢å¼å®ç°è‡ªå®šä¹‰ä¼ è¾“ã€‚

|  **ç‰¹æ€§**  | **stdio** | **Streamable HTTP** |
| :--------: | :-------: | :-----------------: |
| å®ç°å¤æ‚åº¦ |   ç®€å•    |        ä¸­ç­‰         |
|    æ€§èƒ½    |    é«˜     |        ä¸­ç­‰         |
|  ç½‘ç»œæ”¯æŒ  |    âŒ     |         âœ…          |
|  å¤šå®¢æˆ·ç«¯  |    âŒ     |         âœ…          |
|  æµå¼å“åº”  |    âŒ     |         âœ…          |
|  ä¼šè¯ç®¡ç†  |    âŒ     |         âœ…          |
|  æ–­çº¿é‡è¿  |    âŒ     |         âœ…          |
|  è°ƒè¯•éš¾åº¦  |    ä½     |        ä¸­ç­‰         |
| éƒ¨ç½²å¤æ‚åº¦ |    ä½     |        ä¸­ç­‰         |
|  é€‚ç”¨åœºæ™¯  | æœ¬åœ°å·¥å…·  |  Web åº”ç”¨/è¿œç¨‹æœåŠ¡  |

- **4.2.1 Stdio**

  åœ¨ stdio ä¼ è¾“ä¸­ï¼Œå®¢æˆ·ç«¯å°† MCP æœåŠ¡å™¨ä½œä¸ºå­è¿›ç¨‹å¯åŠ¨ã€‚æœåŠ¡å™¨ä»æ ‡å‡†è¾“å…¥ï¼ˆ `stdin` ï¼‰è¯»å– JSON-RPC æ¶ˆæ¯ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°æ ‡å‡†è¾“å‡ºï¼ˆ `stdout` ï¼‰ã€‚æ¶ˆæ¯å¯ä»¥æ˜¯ JSON-RPC è¯·æ±‚ã€é€šçŸ¥ã€å“åº”â€”â€”æˆ–è€…åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªè¯·æ±‚å’Œ/æˆ–é€šçŸ¥çš„ JSON-RPC æ‰¹å¤„ç†ã€‚

  stdio ä¼ è¾“æ˜¯ MCP æœ€åŸºç¡€çš„ä¼ è¾“æ–¹å¼ï¼Œå®ƒé€šè¿‡æ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼ˆstdin/stdoutï¼‰è¿›è¡Œé€šä¿¡ï¼š

  ```mermaid
  sequenceDiagram
      participant Client
      participant Server Process

      Client->>+Server Process: å¯åŠ¨å­è¿›ç¨‹ # Launch subprocess
      loop æ¶ˆæ¯äº¤æ¢ # Message Exchange
          Client->>Server Process: å†™å…¥æ ‡å‡†è¾“å…¥ # Write to stdin
          Server Process->>Client: å†™å…¥æ ‡å‡†è¾“å‡º # Write to stdout
          Server Process--)Client: å¯é€‰çš„ stderr æ—¥å¿— # Optional logs on stderr
      end
      Client->>Server Process: å…³é—­æ ‡å‡†è¾“å…¥ï¼Œç»ˆæ­¢å­è¿›ç¨‹ # Close stdin, terminate subprocess
      deactivate Server Process
  ```

  - Client â†’ Server: é€šè¿‡ stdin å‘é€ JSON-RPC æ¶ˆæ¯
  - Server â†’ Client: é€šè¿‡ stdout è¿”å› JSON-RPC å“åº”
  - stderr: ç”¨äºæ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯è¾“å‡º

  æ¯æ¡æ¶ˆæ¯éƒ½æ˜¯ç‹¬ç«‹çš„ JSON è¡Œï¼š

  ```json
  {"jsonrpc": "2.0", "id": 1, "method": "tools/list", "params": {}}
  {"jsonrpc": "2.0", "id": 1, "result": {"tools": [...]}}
  ```

- **4.2.2 Streamable HTTP ä¼ è¾“**

  > [!TIP] > **ğŸš¨ é‡è¦è¯´æ˜**
  >
  > **Streamable HTTP** æ˜¯ MCP åè®® 2025-03-26 ç‰ˆæœ¬ä¸­çš„æ­£å¼ä¼ è¾“æ–¹å¼ï¼Œå®ƒæ›¿ä»£äº†ä¹‹å‰ç‰ˆæœ¬ï¼ˆ2024-11-05ï¼‰çš„ **HTTP+SSE** ä¼ è¾“ã€‚

  Streamable HTTP åŸºäº HTTPåè®®ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°ä½¿ç”¨ Server-Sent Events (SSE) å®ç°æµå¼é€šä¿¡ï¼š

  **æ ¸å¿ƒç‰¹ç‚¹**ï¼š

  1. ç»Ÿä¸€ç«¯ç‚¹: æœåŠ¡å™¨æä¾›å•ä¸ª HTTP ç«¯ç‚¹ï¼ŒåŒæ—¶æ”¯æŒ POST å’Œ GET æ–¹æ³•
  2. çµæ´»å“åº”: æœåŠ¡å™¨å¯ä»¥è¿”å›ç®€å• JSON å“åº”æˆ– SSE æµ
  3. åŒå‘é€šä¿¡: æ”¯æŒå®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨å’ŒæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯ä¼ 

  ### æ¶ˆæ¯äº¤æ¢æ¨¡å¼

  ```
  POST /mcp HTTP/1.1
  Content-Type: application/json
  Accept: application/json, text/event-stream

  {"jsonrpc": "2.0", "id": 1, "method": "tools/list", "params": {}}
  ```

  ### Server å“åº”æ–¹å¼

  - æ–¹å¼1: JSON å“åº”

    ```http
    HTTP/1.1 200 OK
    Content-Type: application/json

    {"jsonrpc": "2.0", "id": 1, "result": {"tools": [...]}}

    ```

  - æ–¹å¼2: SSE æµå“åº”

    ```http
    HTTP/1.1 200 OK
    Content-Type: text/event-stream

    data: {"jsonrpc": "2.0", "id": 1, "result": {"tools": [...]}}

    data: {"jsonrpc": "2.0", "method": "notifications/progress", "params": {...}}
    ```

  ### Server â†’ Client é€šä¿¡

  æœåŠ¡å™¨å¯ä»¥é€šè¿‡ GET è¯·æ±‚å»ºç«‹ SSE æµæ¥ä¸»åŠ¨å‘é€æ¶ˆæ¯ï¼š

  ```http
  GET /mcp HTTP/1.1
  Accept: text/event-stream
  ```

  ### ä¸ä¹‹å‰ç‰ˆæœ¬çš„åŒºåˆ«

  ä»¥ä¸‹æ˜¯ä¸¤ç§ä¼ è¾“æ–¹å¼çš„ä¸»è¦å·®å¼‚å¯¹æ¯”ï¼š

  | **ç‰¹æ€§**   | **HTTP+SSE (2024-11-05)** | **Streamable HTTP (2025-03-26)** |
  | ---------- | ------------------------- | -------------------------------- |
  | ç«¯ç‚¹æ•°é‡   | åˆ†ç¦»çš„ POST/SSE ç«¯ç‚¹      | ç»Ÿä¸€çš„ MCP ç«¯ç‚¹                  |
  | åè®®å¤æ‚åº¦ | ç›¸å¯¹å¤æ‚                  | ç®€åŒ–ç»Ÿä¸€                         |
  | çµæ´»æ€§     | æœ‰é™                      | é«˜åº¦çµæ´»                         |
  | å‘åå…¼å®¹   | å·²åºŸå¼ƒ                    | æ”¯æŒå‘åå…¼å®¹                     |

### 4.3 **åŸºæœ¬æ¶ˆæ¯ç±»å‹**

MCP å®šä¹‰äº†åŸºäº JSON-RPC 2.0 çš„ä¸‰ç§æ ¸å¿ƒæ¶ˆæ¯ç±»å‹ï¼š

- **Requests**: åŒå‘æ¶ˆæ¯ï¼Œå¸¦æœ‰æ–¹æ³•å’Œå‚æ•°ï¼ŒæœŸæœ›æœ‰å“åº”
- **Responses**: åŒ¹é…ç‰¹å®šè¯·æ±‚ ID çš„æˆåŠŸç»“æœæˆ–é”™è¯¯
- **Notifications**: æ— éœ€å›å¤çš„å•å‘æ¶ˆæ¯

### 4.4 **èƒ½åŠ›åå•†**

Model Context Protocol ä½¿ç”¨äº†ä¸€ç§åŸºäºèƒ½åŠ›ï¼ˆCapability Negotiationï¼‰çš„åå•†æœºåˆ¶ï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼ŒClients å’Œ Servers ä¼šæ˜ç¡®å£°æ˜å®ƒä»¬æ”¯æŒçš„åŠŸèƒ½ï¼Œè€Œè¿™äº›èƒ½åŠ›å†³å®šäº†åœ¨ä¼šè¯æœŸé—´å¯ä»¥ä½¿ç”¨å“ªäº›åè®®ç‰¹æ€§å’ŒåŸè¯­ï¼ˆprimitivesï¼‰

```mermaid
sequenceDiagram
    participant Host
    participant Client
    participant Server

    Host->>+Client: åˆå§‹åŒ– client
    Client->>+Server: ä½¿ç”¨ Client çš„èƒ½åŠ›åˆå§‹åŒ–ä¸€ä¸ªä¼šè¯
    Server-->>Client: è¿”å› Server æ”¯æŒçš„èƒ½åŠ›

    Note over Host,Server: å…·æœ‰åå•†åŠŸèƒ½çš„æ´»åŠ¨ä¼šè¯

    loop Client Requests
        Host->>Client: ç”¨æˆ·æˆ–æ¨¡å‹å‘èµ·çš„æ“ä½œ
        Client->>Server: Request (tools/resources)
        Server-->>Client: Response
        Client-->>Host: æ›´æ–° UI æˆ–å“åº”æ¨¡å‹
    end

    loop Server Requests
        Server->>Client: Request (sampling)
        Client->>Host: è½¬å‘è‡³ AI
        Host-->>Client: AI å“åº”
        Client-->>Server: Response
    end

    loop Notifications
        Server--)Client: Resource æ›´æ–°
        Client--)Server: Status å˜åŒ–
    end

    Host->>Client: ç»ˆæ­¢
    Client->>-Server: ç»“æŸä¼šè¯
    deactivate Server
```

1. **åˆå§‹åŒ–é˜¶æ®µ**
   1. **Host åˆå§‹åŒ– Client**
      å¯åŠ¨ä¸€ä¸ª MCP å®¢æˆ·ç«¯ï¼Œå¦‚åŠ è½½ä¸€ä¸ªæ’ä»¶ã€Agentã€AgentUIã€‚
   2. **Client è¯·æ±‚åˆå§‹åŒ–ä¼šè¯**
      Client å‘ MCP Server å‘èµ· `describe` æˆ– `start_session` è¯·æ±‚ï¼Œè¯¢é—®æœ‰å“ªäº› Agentã€Toolã€Context å¯ç”¨ã€‚
   3. **Server è¿”å›æ”¯æŒçš„èƒ½åŠ›**
      Server å“åº” Server ç«¯å…·å¤‡çš„èƒ½åŠ›ä¿¡æ¯ï¼ˆæ¨¡å‹ç§ç±»ã€æœ€å¤§ tokenã€æ”¯æŒçš„å·¥å…·ç±»å‹ç­‰ï¼‰ã€‚
2. **Client Requests å¾ªç¯ï¼ˆç”¨æˆ·ä¾§çš„è¯·æ±‚ï¼‰**
   1. **ç”¨æˆ·æˆ–æ¨¡å‹å‘èµ·æ“ä½œ**
      æ¯”å¦‚ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ã€ç”¨æˆ·è¾“å…¥ä¸€å¥è¯ï¼Œæˆ–è€… Agent é€»è¾‘å†³å®šè°ƒç”¨æŸä¸ªå·¥å…·ã€‚
   2. **Client æ„é€ è¯·æ±‚å¹¶å‘é€ç»™ Server**
      è¯·æ±‚ä¸­åŒ…å«éœ€è¦è°ƒç”¨çš„ Toolã€è®¿é—®çš„èµ„æºï¼ˆå¦‚æ–‡æ¡£ã€æœç´¢ã€å‡½æ•° APIï¼‰ã€‚
   3. **Server å¤„ç†å¹¶è¿”å› Response**
      MCP Server è°ƒç”¨å¯¹åº”å·¥å…·ï¼ˆå¯èƒ½æ˜¯æ’ä»¶ã€Web APIã€æœ¬åœ°å‡½æ•°ï¼‰å¹¶è¿”å›ç»“æœã€‚
   4. **Client å¤„ç†å“åº”å¹¶åé¦ˆç»™ Hostï¼ˆæ›´æ–° UI æˆ–ç»§ç»­å¯¹è¯ï¼‰**
      æ›´æ–°é¡µé¢çŠ¶æ€ã€å¡«å…¥å›ç­”ï¼Œæˆ–è¿›ä¸€æ­¥è§¦å‘ Agent æ¨ç†ã€‚
3. **Server Requests å¾ªç¯ï¼ˆAI æ¨ç†è¯·æ±‚ï¼‰**
   1. **Server è¯·æ±‚é‡‡æ ·**
      ä¹Ÿå°±æ˜¯è¯·æ±‚æ¨¡å‹è¿›è¡Œè¯­è¨€ç”Ÿæˆï¼ˆ`chat.complete` / `run.sample`ï¼‰ã€‚
   2. **Client å°†è¯·æ±‚è½¬å‘è‡³ Hostï¼ˆè¯­è¨€æ¨¡å‹ï¼‰**
      Host é€šå¸¸åŒ…å«æ¨¡å‹æ¨ç†èƒ½åŠ›ï¼ˆæœ¬åœ°æ¨¡å‹æˆ– OpenAI API ç­‰è¿œç¨‹æ¨¡å‹ï¼‰ã€‚
   3. **Host ç”Ÿæˆå›ç­”å¹¶è¿”å›ç»™ Client**
   4. **Client å†è¿”å›ç»™ Serverï¼Œç»§ç»­ä»»åŠ¡æµç¨‹**

### 4.5 **åè®®è§„èŒƒä¹‹åŸºæœ¬æ¶ˆæ¯ç±»å‹**

> [!NOTE] > [ğŸ“– Source](https://modelcontextprotocol.io/specification/draft/basic/index#notifications)

æ‰€æœ‰åœ¨ MCP clients å’Œ servers ä¹‹é—´çš„æ¶ˆæ¯å¿…é¡»éµå¾ª `JSON-RPC 2.0` è§„èŒƒã€‚è¯¥åè®®å®šä¹‰äº†ä¸‰ç§åŸºæœ¬ç±»å‹çš„æ¶ˆæ¯ï¼š

| **æ¶ˆæ¯ç±»å‹**    | **æè¿°**                     |
| --------------- | ---------------------------- |
| `Requests`      | è¯·æ±‚æœŸæœ›ä»å¯¹æ–¹å¾—åˆ°å“åº”       |
| `Results`       | ç»“æœæ˜¯å¯¹è¯·æ±‚çš„æˆåŠŸå“åº”       |
| `Notifications` | ä¸€æ¬¡æ€§çš„æ¶ˆæ¯ï¼Œä¸éœ€è¦æ¥æ”¶å“åº” |

1. **Request æ¶ˆæ¯è¯·æ±‚**

   è¯·æ±‚ç”±å®¢æˆ·ç«¯å‘é€è‡³æœåŠ¡å™¨ï¼Œæˆ–ç”±æœåŠ¡å™¨å‘é€è‡³å®¢æˆ·ç«¯ï¼Œä»¥å¯åŠ¨ä¸€é¡¹æ“ä½œï¼Œæ ¼å¼ï¼š

   ```tsx
   {
     jsonrpc: "2.0";
     id: string | number;
     method: string;
     params?: {
       [key: string]: unknown;
     };
   }
   ```

   - è¯·æ±‚**å¿…é¡»**åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–æ•´æ•° IDã€‚
   - ä¸åŸºç¡€ JSON-RPC ä¸åŒï¼ŒID **ä¸å¾—**ä¸º `null`ã€‚
   - åœ¨åŒä¸€ä¼šè¯ä¸­ï¼Œè¯·æ±‚æ–¹**ä¸å¾—**é‡å¤ä½¿ç”¨ä¹‹å‰å·²ç”¨è¿‡çš„è¯·æ±‚ IDã€‚

   **ä¸šåŠ¡ç±»å‹ï¼š**

   | **è¯·æ±‚æ–¹æ³•**             | **å‘èµ·æ–¹** | **å“åº”æ–¹** | **æè¿°**                                                           |
   | ------------------------ | ---------- | ---------- | ------------------------------------------------------------------ |
   | initialize               | Client     | Server     | åˆå§‹åŒ–ä¼šè¯                                                         |
   | tools/list               | Client     | Server     | å‘ç°å¯ç”¨çš„å·¥å…·                                                     |
   | tools/call               | Client     | Server     | è°ƒç”¨å·¥å…·                                                           |
   | resources/list           | Client     | Server     | å‘ç°å¯ç”¨çš„èµ„æº                                                     |
   | resources/read           | Client     | Server     | è¦è·å–èµ„æºå†…å®¹                                                     |
   | resources/templates/list | Client     | Server     | å‘ç°å¯ç”¨çš„å‚æ•°åŒ–èµ„æº                                               |
   | resources/subscribe      | Client     | Server     | è®¢é˜…ç‰¹å®šèµ„æºï¼Œå¹¶åœ¨å…¶å‘ç”Ÿå˜åŒ–æ—¶æ¥æ”¶é€šçŸ¥                             |
   | prompts/list             | Client     | Server     | å‘ç°å¯ç”¨çš„æç¤ºè¯                                                   |
   | prompts/get              | Client     | Server     | è¦è·å–ç‰¹å®šçš„æç¤ºè¯                                                 |
   | roots/list               | Server     | Client     | åˆ—å‡º Server æœ‰æƒé™è®¿é—® Client çš„æ–‡ä»¶ç³»ç»Ÿ Root èŠ‚ç‚¹ï¼Œæš´éœ²ç›®å½•å’Œæ–‡ä»¶ |
   | sampling/createMessage   | Server     | Client     | ä½¿ Server èƒ½å¤Ÿåˆ©ç”¨ AI èƒ½åŠ›çš„ç”Ÿæˆèƒ½åŠ›                               |

2. **Response æ¶ˆæ¯å“åº”**

   Response æ˜¯å¯¹ Request çš„å“åº”ï¼Œæ ¼å¼ï¼š

   ```tsx
   {
     jsonrpc: "2.0";
     id: string | number;
     result?: {
       [key: string]: unknown;
     }
     error?: {
       code: number;
       message: string;
       data?: unknown;
     }
   }
   ```

   - å“åº”**å¿…é¡»**åŒ…å«ä¸å…¶å¯¹åº”çš„è¯·æ±‚ç›¸åŒçš„ IDã€‚
   - **å“åº”**è¿›ä¸€æ­¥ç»†åˆ†ä¸º **æˆåŠŸç»“æœ** æˆ– **é”™è¯¯**ã€‚**å¿…é¡»**è®¾ç½®ä¸€ä¸ª`result`æˆ–`error`ã€‚å“åº”**ä¸å¾—**åŒæ—¶è®¾ç½®ä¸¤è€…ã€‚
   - ç»“æœ**å¯ä»¥**éµå¾ªä»»ä½• JSON å¯¹è±¡ç»“æ„ï¼Œè€Œé”™è¯¯**å¿…é¡»**è‡³å°‘åŒ…å«é”™è¯¯ä»£ç å’Œæ¶ˆæ¯ã€‚
   - é”™è¯¯ä»£ç **å¿…é¡»**æ˜¯æ•´æ•°ã€‚

3. **Notificationsï¼ˆé€šçŸ¥ï¼‰**

   `Notifications`ä»¥å•å‘æ¶ˆæ¯çš„å½¢å¼ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨ï¼Œåä¹‹äº¦ç„¶ã€‚æ¥æ”¶æ–¹ä¸å¾—å‘é€å“åº”ã€‚

   ```tsx
   {
     jsonrpc: "2.0";
     method: string;
     params?: {
       [key: string]: unknown;
     };
   }
   ```

   é€šçŸ¥ä¸å¾—åŒ…å« IDã€‚

4. **ä¸¾ä¾‹ï¼šClient è·å– Server Tool åˆ—è¡¨**

   > [!NOTE] > [ğŸ“– Source](https://modelcontextprotocol.io/specification/2025-03-26/server/tools#list-changed-notificationhttps://github.com/modelcontextprotocol/modelcontextprotocol/blob/e0a7d3b7cc286496b5a4585be85e6bd4ff186e36/docs/specification/2025-03-26/server/tools.mdx#L147)

   ```mermaid
   sequenceDiagram
       participant LLM
       participant Client
       participant Server

       Note over Client,Server: æŸ¥æ‰¾å¯ç”¨çš„ Tool åˆ—è¡¨ # Discovery
       Client->>Server: tools/list
       Server-->>Client: List of tools

       Note over Client,LLM: Tool ç­›é€‰ # Tool Selection
       LLM->>Client: é€‰æ‹©éœ€è¦ç”¨åˆ°çš„ Tool # Select tool to use

       Note over Client,Server: è°ƒç”¨ # Invocation
       Client->>Server: tools/call
       Server-->>Client: Tool result
       Client->>LLM: å¤„ç†ç»“æœ # Process result

       Note over Client,Server: æ›´æ–° # Updates
       Server--)Client: tools/list_changed
       Client->>Server: tools/list
       Server-->>Client: Updated tools

   ```

   è¦æŸ¥è¯¢å¯ç”¨çš„å·¥å…·ï¼ŒClientå‘é€ä¸€ä¸ª `tools/list` è¯·æ±‚ã€‚

   **Request**

   ```json
   {
     "jsonrpc": "2.0",
     "id": 1,
     "method": "tools/list",
     "params": {
       "cursor": "optional-cursor-value"
     }
   }
   ```

   **Response**

   ```json
   {
     "jsonrpc": "2.0",
     "id": 1,
     "result": {
       "tools": [
         {
           "name": "get_weather",
           "description": "Get current weather information for a location",
           "inputSchema": {
             "type": "object",
             "properties": {
               "location": {
                 "type": "string",
                 "description": "City name or zip code"
               }
             },
             "required": ["location"]
           }
         }
       ],
       "nextCursor": "next-page-cursor"
     }
   }
   ```

### 4.6 **ç”Ÿå‘½å‘¨æœŸ**

> [!NOTE] > [ğŸ“– Source](https://modelcontextprotocol.io/specification/2025-03-26/basic/lifecycle#lifecyclehttps://github.com/modelcontextprotocol/modelcontextprotocol/blob/e0a7d3b7cc286496b5a4585be85e6bd4ff186e36/docs/specification/2025-03-26/basic/lifecycle.mdx)

æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP) ä¸º client-server è¿æ¥å®šä¹‰äº†ä¸¥æ ¼çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥ç¡®ä¿æ­£ç¡®çš„èƒ½åŠ›åå•†å’ŒçŠ¶æ€ç®¡ç†ã€‚

1. **Initializationï¼ˆåˆå§‹åŒ–ï¼‰**ï¼šèƒ½åŠ›åå•†å’Œåè®®ç‰ˆæœ¬åå•†
2. **Operationï¼ˆæ“ä½œï¼‰**ï¼šæ­£å¸¸åè®®é€šä¿¡
3. **Shutdownï¼ˆç»ˆæ­¢ï¼‰**ï¼šæ­£å¸¸ç»ˆæ­¢è¿æ¥

```mermaid
sequenceDiagram
    participant Client
    participant Server

    Note over Client,Server: 1.åˆå§‹åŒ–é˜¶æ®µ # Initialization Phase
    activate Client
    Client->>+Server: åˆå§‹åŒ– request # initialize request
    Server-->>Client: åˆå§‹åŒ– reponse # initialize response
    Client--)Server: åˆå§‹åŒ– notification # initialized notification

    Note over Client,Server: 2.æ“ä½œé˜¶æ®µ # Operation Phase
    rect rgb(200, 220, 250)
        note over Client,Server: æ­£å¸¸åè®®æ“ä½œ... # Normal protocol operations
    end

    Note over Client,Server: 3.å…³é—­é˜¶æ®µ # Shutdown
    Client--)-Server: å…³é—­è¿æ¥ # Disconnect
    deactivate Server
    Note over Client,Server: è¿æ¥ä»¥å…³é—­ # Connection closed

```

1. **Initialization (åˆå§‹åŒ–)**

   åˆå§‹åŒ–é˜¶æ®µ **å¿…é¡»** æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é¦–æ¬¡äº¤äº’ã€‚åœ¨æ­¤é˜¶æ®µï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€å®Œæˆä»¥ä¸‹æ“ä½œï¼š

   - å»ºç«‹åè®®ç‰ˆæœ¬å…¼å®¹æ€§
   - äº¤æ¢å¹¶åå•†åŠŸèƒ½èƒ½åŠ›
   - å…±äº«å®ç°ç»†èŠ‚

   å®¢æˆ·ç«¯ **å¿…é¡»** é€šè¿‡å‘é€åŒ…å«ä»¥ä¸‹å†…å®¹çš„ `initialize` è¯·æ±‚æ¥å¯åŠ¨æ­¤é˜¶æ®µï¼š

   - æ”¯æŒçš„åè®®ç‰ˆæœ¬
   - å®¢æˆ·ç«¯åŠŸèƒ½èƒ½åŠ›
   - å®¢æˆ·ç«¯å®ç°ä¿¡æ¯

   ```json
   {
     "jsonrpc": "2.0",
     "id": 1,
     "method": "initialize", // è°ƒç”¨çš„æ–¹æ³•åï¼Œè¿™æ˜¯MCPåè®®ä¸­çš„åˆå§‹åŒ–æ¡æ‰‹è¯·æ±‚
     "params": {
       "protocolVersion": "2025-03-26", // æŒ‡å®šå®¢æˆ·ç«¯æ”¯æŒçš„MCPåè®®ç‰ˆæœ¬
       "capabilities": {
         // å®¢æˆ·ç«¯å£°æ˜çš„åŠŸèƒ½èƒ½åŠ›
         "roots": {
           "listChanged": true // è¡¨ç¤ºå®¢æˆ·ç«¯æ”¯æŒæ ¹ç›®å½•å˜æ›´é€šçŸ¥åŠŸèƒ½
         },
         "sampling": {} // è¡¨ç¤ºå®¢æˆ·ç«¯æ”¯æŒé‡‡æ ·åŠŸèƒ½ï¼ˆå…·ä½“é…ç½®ä¸ºç©ºå¯¹è±¡ï¼‰
       },
       "clientInfo": {
         // å®¢æˆ·ç«¯å®ç°ä¿¡æ¯
         "name": "ExampleClient", // å®¢æˆ·ç«¯åç§°
         "version": "1.0.0" // å®¢æˆ·ç«¯ç‰ˆæœ¬å·
       }
     }
   }
   ```

   åˆå§‹åŒ–è¯·æ±‚ **å¿…é¡»ä¸åœ¨** JSON-RPC [æ‰¹å¤„ç†](https://www.jsonrpc.org/specification#batch)ä¸­ï¼Œå› ä¸ºåœ¨åˆå§‹åŒ–å®Œæˆä¹‹å‰æ— æ³•å‘é€å…¶ä»–è¯·æ±‚å’Œé€šçŸ¥ã€‚è¿™ä¹Ÿå…è®¸ä¸ä¹‹å‰ä¸æ˜ç¡®æ”¯æŒ JSON-RPC æ‰¹å¤„ç†çš„åè®®ç‰ˆæœ¬ä¿æŒå‘åå…¼å®¹ã€‚

   > [!TIP]
   > ç®€å•è¯´ï¼Œå°±æ˜¯åˆå§‹åŒ–è¯·æ±‚å¿…é¡»ç‹¬ç«‹å‘é€ï¼Œä¸èƒ½å’Œå…¶ä»–è¯·æ±‚æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œè¿™æ ·ç¡®ä¿äº†åè®®çš„ç¨³å®šæ€§å’Œå…¼å®¹æ€§ã€‚

   æœåŠ¡å™¨ **å¿…é¡»** è¿”å›å…¶è‡ªèº«çš„åŠŸèƒ½å’Œä¿¡æ¯ï¼š

   ```json
   {
     "jsonrpc": "2.0",
     "id": 1, // å¯¹åº”åˆå§‹åŒ–è¯·æ±‚çš„IDï¼Œç”¨äºåŒ¹é…è¯·æ±‚å’Œå“åº”
     "result": {
       "protocolVersion": "2025-03-26", // æœåŠ¡ç«¯æ”¯æŒçš„MCPåè®®ç‰ˆæœ¬
       "capabilities": {
         // æœåŠ¡ç«¯æ”¯æŒçš„åŠŸèƒ½èƒ½åŠ›å£°æ˜
         "logging": {}, // æ—¥å¿—åŠŸèƒ½æ”¯æŒï¼ˆç©ºå¯¹è±¡è¡¨ç¤ºåŸºç¡€æ”¯æŒï¼‰
         "prompts": {
           // æç¤ºè¯åŠŸèƒ½æ”¯æŒ
           "listChanged": true // æ”¯æŒæç¤ºè¯åˆ—è¡¨å˜æ›´é€šçŸ¥
         },
         "resources": {
           // èµ„æºåŠŸèƒ½æ”¯æŒ
           "subscribe": true, // æ”¯æŒèµ„æºè®¢é˜…åŠŸèƒ½
           "listChanged": true // æ”¯æŒèµ„æºåˆ—è¡¨å˜æ›´é€šçŸ¥
         },
         "tools": {
           // å·¥å…·åŠŸèƒ½æ”¯æŒ
           "listChanged": true // æ”¯æŒå·¥å…·åˆ—è¡¨å˜æ›´é€šçŸ¥
         }
       },
       "serverInfo": {
         // æœåŠ¡ç«¯èº«ä»½ä¿¡æ¯
         "name": "ExampleServer", // æœåŠ¡ç«¯åç§°
         "version": "1.0.0" // æœåŠ¡ç«¯ç‰ˆæœ¬å·
       },
       "instructions": "Optional instructions for the client" // å¯é€‰çš„å®¢æˆ·ç«¯ä½¿ç”¨è¯´æ˜æˆ–é…ç½®æŒ‡å¼•
     }
   }
   ```

   åˆå§‹åŒ–æˆåŠŸåï¼Œå®¢æˆ·ç«¯ **å¿…é¡»** å‘é€ä¸€ä¸ª `initialized` é€šçŸ¥ï¼Œä»¥è¡¨ç¤ºå®ƒå·²å‡†å¤‡å¥½å¼€å§‹æ­£å¸¸æ“ä½œï¼š

   ```json
   {
     "jsonrpc": "2.0",
     "method": "notifications/initialized"
   }
   ```

   1. **1.1 ç‰ˆæœ¬åå•†**

      åœ¨ `initialize` è¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯ **å¿…é¡»** å‘é€å…¶æ”¯æŒçš„åè®®ç‰ˆæœ¬ã€‚è¿™é€šå¸¸ **åº”è¯¥** æ˜¯å®¢æˆ·ç«¯æ”¯æŒçš„æœ€æ–°ç‰ˆæœ¬ã€‚

      å¦‚æœæœåŠ¡å™¨æ”¯æŒè¯·æ±‚çš„åè®®ç‰ˆæœ¬ï¼Œå®ƒ **å¿…é¡»** ä½¿ç”¨ç›¸åŒçš„ç‰ˆæœ¬å“åº”ã€‚å¦åˆ™ï¼ŒæœåŠ¡å™¨å¿…é¡»ä½¿ç”¨å®ƒæ”¯æŒçš„å¦ä¸€ä¸ªåè®®ç‰ˆæœ¬è¿›è¡Œå“åº”ã€‚è¿™ **åº”è¯¥** æ˜¯æœåŠ¡å™¨æ”¯æŒçš„æœ€æ–°ç‰ˆæœ¬ã€‚

      å¦‚æœå®¢æˆ·ç«¯ä¸æ”¯æŒæœåŠ¡å™¨å“åº”ä¸­çš„ç‰ˆæœ¬ï¼Œ **åº”è¯¥** æ–­å¼€è¿æ¥ã€‚

   2. **1.2 èƒ½åŠ›åå•†**

      å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„èƒ½åŠ›ç¡®å®šä¼šè¯æœŸé—´å°†å¯ç”¨çš„å¯é€‰åè®®åŠŸèƒ½ã€‚

      å…³é”®èƒ½åŠ›åŒ…æ‹¬ï¼š

      | **ç±»åˆ«** | **èƒ½åŠ›**       | **æè¿°**                            |
      | -------- | -------------- | ----------------------------------- |
      | Client   | `roots`        | æä¾›æ–‡ä»¶ç³»ç»Ÿæ ¹èŠ‚ç‚¹çš„èƒ½åŠ›            |
      | Client   | `sampling`     | æ”¯æŒå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰é‡‡æ ·è¯·æ±‚çš„åŠŸèƒ½ |
      | Client   | `experimental` | æè¿°å¯¹éæ ‡å‡†å®éªŒæ€§åŠŸèƒ½çš„æ”¯æŒ        |
      | Server   | `prompts`      | æä¾›æç¤ºè¯æ¨¡æ¿çš„åŠŸèƒ½                |
      | Server   | `resources`    | æä¾›å¯è¯»å–èµ„æºçš„åŠŸèƒ½                |
      | Server   | `tools`        | æš´éœ²å¯è°ƒç”¨å·¥å…·çš„åŠŸèƒ½                |
      | Server   | `logging`      | å‘é€ç»“æ„åŒ–æ—¥å¿—æ¶ˆæ¯çš„åŠŸèƒ½            |
      | Server   | `experimental` | æè¿°å¯¹éæ ‡å‡†å®éªŒæ€§åŠŸèƒ½çš„æ”¯æŒ        |

      èƒ½åŠ›å¯¹è±¡å¯ä»¥æè¿°å­èƒ½åŠ›ï¼Œå¦‚ï¼š

      - `listChanged` : æ”¯æŒåˆ—è¡¨å˜æ›´é€šçŸ¥ï¼ˆé’ˆå¯¹æç¤ºã€èµ„æºå’Œå·¥å…·ï¼‰
      - `subscribe` : æ”¯æŒè®¢é˜…ä¸ªåˆ«é¡¹ç›®çš„å˜æ›´ï¼ˆä»…èµ„æºï¼‰

2. **Operation (æ“ä½œ)**

   åœ¨è¿è¡Œé˜¶æ®µï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ ¹æ®åå•†çš„èƒ½åŠ›äº¤æ¢æ¶ˆæ¯ã€‚

   åŒæ–¹ **åº”è¯¥**ï¼š

   - å°Šé‡åå•†ç¡®å®šçš„åè®®ç‰ˆæœ¬
   - ä»…ä½¿ç”¨æˆåŠŸåå•†çš„ Capability

3. **Shutdownï¼ˆå…³é—­ï¼‰**

   åœ¨å…³é—­é˜¶æ®µï¼Œä¸€æ–¹ï¼ˆé€šå¸¸æ˜¯å®¢æˆ·ç«¯ï¼‰ä¼šå¹²å‡€åœ°ç»ˆæ­¢åè®®è¿æ¥ã€‚æ²¡æœ‰å®šä¹‰ç‰¹å®šçš„å…³é—­æ¶ˆæ¯â€”â€”ç›¸åï¼Œåº”ä½¿ç”¨åº•å±‚ä¼ è¾“æœºåˆ¶æ¥ä¿¡å·è¿æ¥ç»ˆæ­¢ï¼š

   - stdio
     å¯¹äº stdio ä¼ è¾“ï¼Œå®¢æˆ·ç«¯ **åº”è¯¥** é€šè¿‡ä»¥ä¸‹æ–¹å¼å‘èµ·å…³é—­ï¼š
     - é¦–å…ˆï¼Œå…³é—­å­è¿›ç¨‹ï¼ˆæœåŠ¡å™¨ï¼‰çš„è¾“å…¥æµã€‚
     - ç­‰å¾…æœåŠ¡å™¨é€€å‡ºï¼Œæˆ–åœ¨åˆç†æ—¶é—´å†…æœªé€€å‡ºæ—¶å‘é€ `SIGTERM`
     - å‘é€ `SIGKILL` ï¼Œå¦‚æœæœåŠ¡å™¨åœ¨åˆç†æ—¶é—´å†…æœªå¯åŠ¨ï¼Œåˆ™å‘é€ `SIGTERM`

   æœåŠ¡å™¨ **å¯ä»¥** é€‰æ‹©é€šè¿‡å…³é—­å¯¹å…¶å®¢æˆ·ç«¯çš„è¾“å‡ºæµå¹¶é€€å‡ºæ¥å‘èµ·å…³é—­ã€‚

   - HTTP
     å¯¹äº HTTP ä¼ è¾“ï¼Œå…³é—­ç›¸å…³çš„ HTTP è¿æ¥è¡¨ç¤ºå…³é—­ã€‚

4. **Error Handling (é”™è¯¯å¤„ç†)**

   å®ç° **åº”è¯¥** å‡†å¤‡å¥½å¤„ç†è¿™äº›é”™è¯¯æƒ…å†µï¼š

   - åè®®ç‰ˆæœ¬ä¸åŒ¹é…
   - æœªèƒ½åå•†æ‰€éœ€åŠŸèƒ½
   - åˆå§‹åŒ–è¯·æ±‚è¶…æ—¶
   - å…³é—­è¶…æ—¶

   å®ç° **åº”è¯¥** ä¸ºæ‰€æœ‰è¯·æ±‚å®ç°é€‚å½“çš„è¶…æ—¶ï¼Œä»¥é˜²æ­¢è¿æ¥æŒ‚èµ·å’Œèµ„æºè€—å°½ã€‚

   ç¤ºä¾‹ï¼šåˆå§‹åŒ–é”™è¯¯ï¼š

   ```json
   {
     "jsonrpc": "2.0",
     "id": 1,
     "error": {
       "code": -32602,
       "message": "Unsupported protocol version",
       "data": {
         "supported": ["2024-11-05"],
         "requested": "1.0.0"
       }
     }
   }
   ```

## 5. **MCP Server çš„ä½¿ç”¨ï¼šä»¥ Github MCP ä¸ºä¾‹**

ä»¥ Cursor + Github ä¸ºä¾‹ï¼Œä½“éªŒè®©AIç›´æ¥æ“ä½œä»£ç ä»“åº“ï¼š

### æ­¥éª¤1ï¼šåˆ›å»ºGithubä¸ªäººè®¿é—®ä»¤ç‰Œ

1. è®¿é—® [Github Token è®¾ç½®é¡µ](https://github.com/settings/tokens)
2. å‹¾é€‰ `repo` å’Œ `workflow` æƒé™
3. ç”Ÿæˆä»¥ `ghp_` å¼€å¤´çš„ä»¤ç‰Œå­—ç¬¦ä¸²

### æ­¥éª¤2ï¼šé…ç½®MCP Server

åœ¨ Cursor æŒ‰ä¸€ä¸‹æ­¥éª¤æ‰“å¼€ MCP é…ç½®æ–‡ä»¶ï¼š

![MCP_step_1](/static/images/blog/202507/MCP_Revisited/MCP_step_1.webp)

è¾“å…¥ä»¥ä¸‹ä»£ç ï¼Œå¹¶å°† `<YOUR_GITHUB_PERSONAL_ACCESS_TOKEN>` æ›¿æ¢ä¸ºä½ çš„ Github çš„ Personal Access Tokenï¼š

```json:mcp.json showLineNumbers
{
    "mcpServers": {
        "github": {
            "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
          "GITHUB_PERSONAL_ACCESS_TOKEN": "<YOUR_GITHUB_PERSONAL_ACCESS_TOKEN>"
      }
    }
  }
}
```

![MCP_step_2](/static/images/blog/202507/MCP_Revisited/MCP_step_2.webp)

### æ­¥éª¤3ï¼šéªŒè¯è¿æ¥

å½“çŠ¶æ€æŒ‡ç¤ºç¯å˜ç»¿åï¼Œå°è¯•è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼š

![MCP_step_3](/static/images/blog/202507/MCP_Revisited/MCP_step_3.webp)

å½“æˆ‘ä»¬æå‡ºé—®é¢˜åï¼Œä¼šå‘ç° cursor è‡ªåŠ¨å»ä½¿ç”¨ Github MCP çš„ `search_repositories` å»æœç´¢æˆ‘çš„ Github ä»“åº“ã€‚

ç„¶åä½¿ç”¨äº† 5 æ¬¡ `git_file_contents` æ¥è·å–æ¯ä¸ªé¡¹ç›®çš„æ–‡ä»¶ä¿¡æ¯ã€‚

![MCP_step_4](/static/images/blog/202507/MCP_Revisited/MCP_step_4.webp)

æœ€åç»“åˆæ‰€æœ‰ä¿¡æ¯ cursor ç»™æˆ‘ä»¬è¾“å‡ºäº†æœ€åçš„ç»“æœï¼š

![MCP_step_5](/static/images/blog/202507/MCP_Revisited/MCP_step_5.webp)

## 6. MCP Server å¼€å‘å…¥é—¨ï¼šä»¥å¤©æ°”æŸ¥è¯¢ MCP ä¸ºä¾‹

### 1. åˆ›å»ºé¡¹ç›®

```bash
# ä¸ºé¡¹ç›®åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹
mkdir weather
cd weather

# åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ npm é¡¹ç›®
npm init -y

# å®‰è£…ä¾èµ–
pnpm add @modelcontextprotocol/sdk zod
pnpm add -D @types/node typescript

# åˆ›å»ºä»£ç æ–‡ä»¶
mkdir src
touch src/index.ts
```

æ›´æ–°ä½ çš„ package.json ä»¥æ·»åŠ ç±»å‹ï¼šâ€œmoduleâ€å’Œæ„å»ºè„šæœ¬ï¼š

```json showLineNumbers
{
  "type": "module",
  "bin": {
    "weather": "./build/index.js"
  },
  "scripts": {
    "build": "tsc && chmod 755 build/index.js"
  },
  "files": ["build"]
}
```

`tsconfig.json`åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªï¼š

```json:tsconfig.json showLineNumbers
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "Node16",
    "moduleResolution": "Node16",
    "outDir": "./build",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules"]
}
```

### 2. æ„å»ºæœåŠ¡å™¨

```ts:index.ts showLineNumbers
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import { z } from 'zod';

const NWS_API_BASE = 'https://api.weather.gov';
const USER_AGENT = 'weather-app/1.0';

// åˆ›å»º MCP æœåŠ¡å™¨å®ä¾‹
const server =new McpServer({
    name: 'weather',
    version: '1.0.0',
    capabilities: {
        resources: {},
        tools: {},
    },
});

// è¾…åŠ©å‡½æ•°ï¼Œç”¨äºå‘ NWS API å‘é€è¯·æ±‚
async function makeNWSRequest<T>(url:string):Promise<T |null> {
    const headers = {
        'User-Agent': USER_AGENT,
        Accept: 'application/geo+json',
    };

    try {
        const response = await fetch(url, { headers });
        if (!response.ok) {
            thrownewError(`HTTP error! status: ${response.status}`);
        }
        return (await response.json()) asT;
    } catch (error) {
        console.error('Error making NWS request:', error);
        return null;
    }
}

interfaceAlertFeature {
    properties: {
        event?:string;
        areaDesc?:string;
        severity?:string;
        status?:string;
        headline?:string;
    };
}

// æ ¼å¼åŒ–è­¦æŠ¥æ•°æ®
function formatAlert(feature:AlertFeature):string {
    const props =feature.properties;
    return [
        `Event: ${props.event || 'Unknown'}`,
        `Area: ${props.areaDesc || 'Unknown'}`,
        `Severity: ${props.severity || 'Unknown'}`,
        `Status: ${props.status || 'Unknown'}`,
        `Headline: ${props.headline || 'No headline'}`,
        '---',
    ].join('\n');
}

interfaceForecastPeriod {
    name?:string;
    temperature?:number;
    temperatureUnit?:string;
    windSpeed?:string;
    windDirection?:string;
    shortForecast?:string;
}

interfaceAlertsResponse {
    features:AlertFeature[];
}

interfacePointsResponse {
    properties: {
        forecast?:string;
    };
}

interfaceForecastResponse {
    properties: {
        periods:ForecastPeriod[];
    };
}

// Register weather tools
server.tool(
    'get-alerts',
    'Get weather alerts for a state',
    {
        state: z.string().length(2).describe('Two-letter state code (e.g. CA, NY)'),
    },
    async ({state }) => {
        const stateCode =state.toUpperCase();
        const alertsUrl = `${NWS_API_BASE}/alerts?area=${stateCode}`;
        const alertsData = await makeNWSRequest<AlertsResponse>(alertsUrl);

        if (!alertsData) {
            return {
                content: [
                    {
                        type: 'text',
                        text: 'Failed to retrieve alerts data',
                    },
                ],
            };
        }

        const features = alertsData.features || [];
        if (features.length === 0) {
            return {
                content: [
                    {
                        type: 'text',
                        text: `No active alerts for ${stateCode}`,
                    },
                ],
            };
        }

        const formattedAlerts = features.map(formatAlert);
        const alertsText = `Active alerts for ${stateCode}:\n\n${formattedAlerts.join('\n')}`;

        return {
            content: [
                {
                    type: 'text',
                    text: alertsText,
                },
            ],
        };
    }
);

server.tool(
    'get-forecast',
    'Get weather forecast for a location',
    {
        latitude: z.number().min(-90).max(90).describe('Latitude of the location'),
        longitude: z.number().min(-180).max(180).describe('Longitude of the location'),
    },
    async ({latitude,longitude }) => {
        // Get grid point data
        const pointsUrl = `${NWS_API_BASE}/points/${latitude.toFixed(4)},${longitude.toFixed(4)}`;
        const pointsData = await makeNWSRequest<PointsResponse>(pointsUrl);

        if (!pointsData) {
            return {
                content: [
                    {
                        type: 'text',
                        text: `Failed to retrieve grid point data for coordinates: ${latitude}, ${longitude}. This location may not be supported by the NWS API (only US locations are supported).`,
                    },
                ],
            };
        }

        const forecastUrl = pointsData.properties?.forecast;
        if (!forecastUrl) {
            return {
                content: [
                    {
                        type: 'text',
                        text: 'Failed to get forecast URL from grid point data',
                    },
                ],
            };
        }

        // Get forecast data
        const forecastData = await makeNWSRequest<ForecastResponse>(forecastUrl);
        if (!forecastData) {
            return {
                content: [
                    {
                        type: 'text',
                        text: 'Failed to retrieve forecast data',
                    },
                ],
            };
        }

        const periods = forecastData.properties?.periods || [];
        if (periods.length === 0) {
            return {
                content: [
                    {
                        type: 'text',
                        text: 'No forecast periods available',
                    },
                ],
            };
        }

        // Format forecast periods
        const formattedForecast = periods.map((period:ForecastPeriod) =>
            [
                `${period.name || 'Unknown'}:`,
                `Temperature: ${period.temperature || 'Unknown'}Â°${period.temperatureUnit || 'F'}`,
                `Wind: ${period.windSpeed || 'Unknown'} ${period.windDirection || ''}`,
                `${period.shortForecast || 'No forecast available'}`,
                '---',
            ].join('\n')
        );

        const forecastText = `Forecast for ${latitude}, ${longitude}:\n\n${formattedForecast.join(
            '\n'
        )}`;

        return {
            content: [
                {
                    type: 'text',
                    text: forecastText,
                },
            ],
        };
    }
);

async function main() {
    const transport =new StdioServerTransport();
    await server.connect(transport);
    console.error('Weather MCP Server running on stdio');
}

main().catch(error => {
    console.error('Fatal error in main():',error);
    process.exit(1);
});
```

### 3. è°ƒè¯•

ä½¿ç”¨å®˜æ–¹æä¾›çš„è°ƒè¯•å™¨ï¼š

```bash
npx @modelcontextprotocol/inspector node build/index.js
```
