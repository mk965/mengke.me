---
title: 'Nest.js Typrorm å¤šå¯¹å¤šå…³ç³»å¦‚ä½•åˆ›å»º'
date: '2023-04-11'
tags: ['Nest.js']
draft: false
summary: 'Nest.js Typrorm å¤šå¯¹å¤šå…³ç³»å¦‚ä½•åˆ›å»º'
images: ['/static/images/blog/202304/Nest_Typrorm_many_to_many/note.webp']
authors: ['default']
---

ä½¿ç”¨ Typeorm åˆ›å»ºå¤šå¯¹å¤šå…³ç³»çš„æ—¶å€™ï¼Œå¯æŒ‰ä»¥ä¸‹æ–¹æ³•è¿›è¡Œã€‚

ä»¥ Article å’Œ Tag çš„å…³ç³»ä¸ºä¾‹ï¼š

```tsx showLineNumbers
@Entity()
export class Article extends CommonEntity {
  // ...

  // æ ‡ç­¾
  @ManyToMany(() => Tag, (tag) => tag.articles)
  @JoinTable()
  tags: Tag[]
}
```

```tsx showLineNumbers
@Entity()
export class Tag extends CommonEntity {
  // æ ‡ç­¾å
  @Column()
  @IsNotEmpty()
  label: string

  // ä½¿ç”¨çš„æ–‡ç« 
  @ManyToMany(() => Article, (article) => article.tags)
  articles: Article[]
}
```

```tsx showLineNumbers
@Module({
  imports: [TypeOrmModule.forFeature([Tag])],
  controllers: [TagController],
  providers: [TagService],
  exports: [TagService],
})
export class TagModule {}
```

```tsx showLineNumbers
@Module({
  imports: [TypeOrmModule.forFeature([Article]), TagModule],
  controllers: [ArticleController],
  providers: [ArticleService],
})
export class ArticleModule {}
```

åœ¨ article.service.ts ä¸­è°ƒç”¨ Tag.Service.ts ä¸­çš„æ–¹æ³•ï¼š

```tsx showLineNumbers
@Injectable()
export class ArticleService {
  list: any[]
  constructor(
    @InjectRepository(Article)
    private readonly articleRepository: Repository<Article>,
    private readonly tagService: TagService
  ) {}

  /**
   * åˆ›å»ºæ–‡ç« 
   * @param articleCreateDto
   * @returns
   */
  async create(articleCreateDto: ArticleCreateDto) {
    // ...

    // åœ¨æ­¤å¤„å°±å¯ä»¥ä½¿ç”¨ this.tagService æ¥è°ƒç”¨ Tag.service ä¸­çš„æ–¹æ³•äº†
    const tags = await this.tagService.findByIds(ids)
    console.log('æ‰€æœ‰ tag idï¼š', ids, 'æ–‡ç« ä¸­çš„tags', tags)

    // ...
  }
}
```

**âš ï¸Â æ³¨æ„ï¼š**

- åœ¨ article.service ä¸­è°ƒç”¨ tag.service ä¸­çš„æ–¹æ³•çš„æ—¶å€™è¦å…ˆåœ¨ article.module ä¸­ imports å¯¼å…¥ TagModule æ¨¡å—ã€‚
- è¿˜éœ€è¦åœ¨ tag.module ä¸­ exports TagServiceï¼Œå¦åˆ™æŠ¥ä»¥ä¸‹é”™ã€‚

  ```tsx showLineNumbers
  Nest can't resolve dependencies of the ArticleService (ArticleRepository, ?). Please make sure that the argument TagService at index [1] is available in the ArticleModule context.

  Potential solutions:
  - Is ArticleModule a valid NestJS module?
  - If TagService is a provider, is it part of the current ArticleModule?
  - If TagService is exported from a separate @Module, is that module imported within ArticleModule?
    @Module({
      imports: [ /* the Module containing TagService */ ]
    })
  ```

æˆ‘ä¸€å¼€å§‹ä»¥ä¸ºåƒæ™®é€š js ä¸€æ ·ç›´æ¥åœ¨ article.service ä¸­å¯¼å…¥å°±å¯ä»¥ä½¿ç”¨ tag.service ä¸­çš„æ–¹æ³•ï¼Œå¯¼è‡´ä¸€ç›´æŠ¥é”™ï¼Œåæ¥å‘ç°éœ€è¦åœ¨ article.module ä¸­å¯¼å…¥ TagModule æ¨¡å—æ‰å¯ä»¥ã€‚

åæ¥å¯¼å…¥ä¹‹åè¿˜æ˜¯æŠ¥é”™ï¼Œå°±æ˜¯ä¸Šè¾¹è¿™ä¸ªé”™â¬†ï¸ï¼Œæœ€åæ‰å‘ç°è¦å…ˆå¯¼å‡º tag.module ä¸­å…ˆå¯¼å‡º TagService æ‰å¯ä»¥ã€‚

angular çš„æ€æƒ³å’Œæ™®é€š js å·®åˆ«å¥½å¤§å•Š ğŸ˜‚Â â€¦
